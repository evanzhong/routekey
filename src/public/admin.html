<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>Routekey</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- <link rel=" stylesheet" type="text/css" media="screen" href="main.css"> -->
		<link href="https://fonts.googleapis.com/css?family=Oxygen" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">
		<style>
			body{
				text-align: center;
				font-family: 'Oxygen', sans-serif;
				/* background-color: #900C34;
				background-color: #800020; */
			}
			#welcome{
				font-size: 24px;
				color: darkgray;
				padding-bottom: 20px;
				border-bottom: 1px solid gainsboro;
			}
			main{
				margin: auto;
				text-align: center;
				width: 55vw;
				max-width: 750px;
			}
			.form-wrapper{
				background-color: #EEEEEE; 
				padding: 35px;
				padding-left: 50px;
				padding-right: 50px;
				margin-top: 50px;
				border-radius: 0.25em;
			}
			#routekey{
				font-size: 60px;
				color: dimgray;
				margin-bottom: 5px;
				margin-top: 5px;
			}
			#explanation{
				margin-top: 0px;
				font-size: 15px;
			}
			form{
				margin: 20px;
			}
			input, select{
				font-family: 'Oxygen', sans-serif;
				font-size: 15px;
				padding: 5px;
				margin-bottom: 10px;
				width: 100%;
				height: 35px;
				border-radius: 0.35em;
				border: 1px solid gainsboro;
				box-sizing: border-box;

			}
			input:focus{
				outline: none;
				box-shadow: inset 0 0 10px #C3E3FF;
				transition: 0.3s ease-in-out;
			}
			select:focus{
				outline: none;
				box-shadow: inset 0 0 10px #C3E3FF;
				transition: 0.3s ease-in-out;
			}
			button{
				cursor: pointer;
				margin-top: 10px;
				margin: auto;
				width: 100%;
				height: 50px;
				border-radius: 0.25em;
				border: 1px solid #800020;
				box-sizing: border-box;
				font-size: 25px;
				font-family: 'ubuntu';
				color: white;
				background-color: #800020;
			}
			button:focus{
				outline: none;
			}
			a:visited{
				color: blue;
			}
			/* Tachyons */
			.dim {
				opacity: 1;
				transition: opacity .15s ease-in;
			}
			.dim:hover{
				opacity: .5;
				transition: opacity .15s ease-in;
			}
			.dim:active {
				opacity: .8; transition: opacity .15s ease-out;
			}
			/* Fade in */
			.fade-in {
				opacity: 1;
				animation-name: fadeInOpacity;
				animation-iteration-count: 1;
				animation-timing-function: ease-in;
				animation-duration: 1s;
			}

			@keyframes fadeInOpacity {
				0% {
					opacity: 0;
				}
				100% {
					opacity: 1;
				}
			}
			/* Generated by script */
			#notif{
				font-size: 30px;
				margin-bottom: 10px; 
			}
			#notif b{
				font-size: 35px;
				font-weight: 900;
			}
			#notif-link{
				font-size: 20px;
			}
		</style>
	</head>
	<body>
		<main>
			<h3 id="welcome">RouteKey: A url shortener built for the school on Key Route</h3>
			<h1>Admin page</h1>
			<section class="form-wrapper fade-in">
				<h1 id="routekey">RouteKey Admin Generation</h1>
				<p id="explanation">Generate a RouteKey with a phrase you select yourself</p>
				<form>
					<input class="url" type="url" placeholder="Paste full url: (i.e. http://blog.interviewing.io/can-fake-names-create-bias/)" required name="url" autofocus>
					<input class="phrase" type="text" placeholder="Enter a phrase, using dashes instead of spaces (i.e. bmun-waiver-2019)" required name="phrase">
					<select class="expire" list="expireTimes" required name="expire">
						<option value="10080">1 Week</option>
						<option value="20160">2 Weeks</option>
						<option value="40320">1 Month</option>
						<option value="120960">3 Months</option>
					</select>
					<button type="submit" class="submit dim">Generate!</button>
				</form>
				<section class="generated"></section>
			</section>
			<a href="/">Go generate a new RouteKey!</a>
		</main>
		<script>
		const form = document.querySelector('form');
		const result = document.querySelector('.generated');

		form.addEventListener('submit', event => {
			event.preventDefault();
			const input = document.querySelector('.url');
			const phrase = document.querySelector('.phrase');
			const expireSelected = document.querySelector('.expire');
			fetch('/admin-route', {
				method: 'POST',
				headers: {
					'Accept': 'application/json',
					'Content-Type': 'application/json'
				},
				body: JSON.stringify({
					url: input.value,
					phrase: phrase.value,
					expireTime: expireSelected.options[expireSelected.selectedIndex].value,
				})
			})
				.then(response => response.json())
				.then(body => {
					while (result.hasChildNodes()) {
						result.removeChild(result.lastChild);
					}
					console.log(JSON.stringify(body));
					result.insertAdjacentHTML('afterbegin', `
						<div class="generated-wrapper">
							<p id="notif">Your generated RouteKey is: <b>${body.key}</b></p>
							<div id="notif-link">
								<span>Go to: </span>
								<a target="_blank" class="generated-url" rel="noopener" href="/${body.key}">
									${location.origin}/${body.key}
								</a>
								<span> to use </span>
							</div>
						</div>
					`)
				})
				.catch(console.error)
		});
		</script>
	</body>
</html>